# План: Секция «Каталог ЖК в Москве» — приведение к эталону

## Эталонный макет
- **Скриншот:** приложен — карточки ЖК с бейджами, ценой, подписью, данными о квартирах
- **Секция:** `#catalog-jk-section`

## Цель
Привести карточки жилых комплексов (ResidentialComplexCard) и секцию ResidentialComplexSection к соответствию макету.

**Затрагиваемые файлы:**
- `src/components/sections/ResidentialComplexSection.jsx` — секция, заголовок, кнопки, сетка
- `src/components/ui/ResidentialComplexCard.jsx` — карточка ЖК, изображение, бейджи, иконка, контент, hover-логика

---

## TASK 3.1 — Общая структура карточки ЖК

**Текущее состояние:**
- Изображение сверху ✓
- Бейджи поверх изображения ✓
- Иконка избранного справа ✓
- Контент под изображением ✓
- При hover: высота изображения меняется (200→80) — вызывает layout shift

**Действия:**
- [ ] Убрать смещения элементов относительно сетки
- [ ] Обеспечить одинаковую высоту карточек в ряду (`grid`, `auto-rows-fr` или `min-h`)
- [ ] Проверить выравнивание: изображение, контент, бейджи — строго по макету

**Результат:** Карточки ровные, сетка читается, нет «прыгающих» элементов.

---

## TASK 3.2 — Заголовок ЖК (название)

**Текущее состояние:**
- `text-sm font-rubik font-medium leading-snug line-clamp-2 mb-1`

**Действия:**
- [ ] Привести font-size, font-weight, line-height, letter-spacing по макету
- [ ] Исключить хаотичный перенос — максимум 2 строки, далее многоточие (line-clamp-2)
- [ ] Добавить отступ сверху, чтобы не «залипало» к изображению

**Результат:** Название читается легко, визуально как в макете.

---

## TASK 3.3 — Цена и подпись

**Текущее состояние:**
- Цена: `text-base font-bold mb-1`
- Подпись: `text-gray-medium text-xs mb-2`

**Действия:**
- [ ] Цена: более жирный шрифт, акцент
- [ ] Подпись («В продаже …»): вторичный цвет, меньший размер
- [ ] Выровнять вертикальные отступы между ценой и подписью

**Результат:** Цена — главный визуальный акцент, подписи не перегружают.

---

## TASK 3.4 — Бейджи (Новостройка / Рассрочка / ТОП продаж)

**Текущее состояние:**
- `px-2 py-1 bg-white/95 rounded-md text-xs font-rubik font-medium shadow-sm`
- `top-2 left-2 flex flex-wrap gap-1`

**Действия:**
- [ ] Одинаковая высота, padding, скругление по макету
- [ ] Бейджи не перекрывают друг друга (flex-wrap + gap)
- [ ] Отступы от краёв изображения — не «прилипают»

**Результат:** Бейджи аккуратные, читаемые, без визуального шума.

---

## TASK 3.5 — Иконка избранного

**Текущее состояние:**
- Позиция: `top-2 right-2`
- IconButton `size="sm"` (w-9 h-9)
- Иконка 18×18

**Действия:**
- [ ] Зафиксировать позицию: всегда правый верхний угол
- [ ] Одинаковые отступы от краёв
- [ ] Добавить hover-анимацию: scale + opacity (плавно)
- [ ] Убрать резкие состояния при наведении

**Результат:** Иконка плавная, без дёрганий.

---

## TASK 3.6 — Hover по карточке (основной сценарий)

**Текущее состояние:**
- При hover: `height: expanded ? 80 : 200` — изображение сжимается
- `transition: height 0.25s ease`
- **Проблема:** изменение `height` вызывает layout shift и reflow (см. TASK 3.11)

**Действия:**
- [ ] При наведении: изображение плавно уменьшается по высоте, контент расширяется снизу
- [ ] Анимация: duration 200–250ms, easing: ease-out
- [ ] **Использовать transform (scaleY) или фиксированную высоту + opacity**, чтобы избежать layout shift (см. TASK 3.11)
- [ ] Без скачков layout и reflow

**Результат:** Hover плавный, «дорогой», без лагов.

---

## TASK 3.7 — Hover: раскрытие данных о квартирах

**Текущее состояние:**
- `maxHeight: expanded ? 120 : 0`, `opacity: expanded ? 1 : 0`
- При hover показываются до 4 строк квартир

**Действия:**
- [ ] Максимум 4 строки квартир
- [ ] Плавное появление: fade + translateY
- [ ] Контент не выходит за пределы карточки (overflow-hidden)

**Результат:** Информация появляется аккуратно, карточка не ломается.

---

## TASK 3.8 — Перелистывание изображений при наведении

**Текущее состояние:**
- Клик по изображению: левая часть → предыдущее, правая → следующее
- Без mousemove

**Действия:**
- [ ] При движении курсора по изображению:
  - влево → предыдущее фото
  - вправо → следующее фото
- [ ] Без автоплея
- [ ] Debounce для mousemove, чтобы избежать дёрганий
- [ ] Плавная смена кадров (opacity/transform)

**Результат:** Листание как в premium-каталогах.

---

## TASK 3.9 — Клик по карточке

**Текущее состояние:**
- `onClick={handleCardClick}` на article
- Исключения: `e.target.closest('button')`, `e.target.closest('a')`
- Переход: `navigate(\`/new-building/${id}\`)`

**Действия:**
- [ ] Вся карточка кликабельна
- [ ] Исключить: иконка избранного, внутренние кнопки («Подробнее»)
- [ ] Убедиться, что «Подробнее» также ведёт на страницу ЖК (уже реализовано)

**Результат:** Пользователь интуитивно понимает, куда ведёт карточка.

---

## TASK 3.10 — Кнопка «Все предложения»

**Текущее состояние:**
- `Button variant="ghost" size="sm"` с `to="/catalog/new-buildings"`
- `className="bg-gray-50 hover:bg-gray-100"`

**Действия:**
- [ ] Привести к макету: размер, скругление, шрифт
- [ ] Добавить hover-анимацию: background + shadow
- [ ] Сделать визуально CTA, а не вторичным элементом

**Результат:** Кнопка выглядит как CTA.

---

## TASK 3.11 — Производительность и плавность

**Текущее состояние:**
- Используется `height` transition для изображения — вызывает layout shift
- Используется `maxHeight` для блока квартир — тоже layout-affecting

**Действия:**
- [ ] Заменить transition `height` на `transform: scaleY` или фиксированную высоту + overflow
- [ ] Для раскрытия квартир: использовать `opacity` + `transform: translateY` вместо maxHeight
- [ ] Запретить transition для width/height где возможно
- [ ] Проверить: без layout shift, без резких repaint

**Результат:** Анимации стабильные на слабых устройствах.

---

## TASK 3.12 — Мобильная версия карточек ЖК (общее)

**Текущее состояние:**
- `grid-cols-1 sm:grid-cols-2 lg:grid-cols-4`
- Hover-логика одинакова для desktop и mobile

**Действия:**
- [ ] Mobile: 1 колонка
- [ ] Без hover-зависимостей — раскрытие данных по тапу
- [ ] Листание изображений — свайпом (touch events)
- [ ] Все кликабельные элементы ≥ 44px (touch targets)
- [ ] Медиа-запросы: `@media (hover: hover)` для hover-only логики

**Результат:** Карточки удобны для пальца, логика понятна без hover.

---

## TASK M3.1 — Общая структура карточки ЖК (mobile)

**Действия:**
- [ ] Привести карточку к мобильной структуре макета:
  - изображение сверху
  - контент строго под изображением
  - без боковых колонок
- [ ] Карточка на всю ширину экрана
- [ ] Скругления и отступы как в макете

**Результат:** Карточка выглядит цельной, не «разваливается» на мобильном.

---

## TASK M3.2 — Изображение ЖК (mobile)

**Действия:**
- [ ] Фиксированное соотношение сторон (как в макете)
- [ ] Скругление по всем углам
- [ ] Убрать обрезания важных зон изображения
- [ ] Добавить индикатор перелистывания (точки)

**Результат:** Картинка крупная, читаемая, без случайных обрезов.

---

## TASK M3.3 — Бейджи на изображении (mobile)

**Действия:**
- [ ] Разместить бейджи строго по макету:
  - в верхней зоне изображения
  - с одинаковыми отступами
- [ ] Бейджи не перекрывают друг друга
- [ ] Размер бейджей адаптирован под touch

**Результат:** Бейджи аккуратные, не мешают просмотру изображения.

---

## TASK M3.4 — Перелистывание изображений (mobile)

**Действия:**
- [ ] Реализовать свайп влево / вправо по изображению
- [ ] Без автоплея
- [ ] Без резких скачков
- [ ] Плавная анимация перелистывания

**Результат:** Свайп ощущается нативно, как в приложениях недвижимости.

---

## TASK M3.5 — Заголовок ЖК (mobile)

**Действия:**
- [ ] Привести font-size, font-weight, line-height по макету
- [ ] Максимум 2 строки, далее многоточие
- [ ] Заголовок не должен прилипать к изображению

**Результат:** Название легко читается с первого взгляда.

---

## TASK M3.6 — Цена и основная информация (mobile)

**Действия:**
- [ ] Цена: выделена визуально, более жирный шрифт
- [ ] Подпись «В продаже …» вторичным цветом
- [ ] Выровнять отступы между строками

**Результат:** Цена сразу заметна, информация не перегружает карточку.

---

## TASK M3.7 — Таблица типов квартир (mobile)

**Действия:**
- [ ] Привести список типов квартир к макету:
  - 3 колонки: тип / метраж / цена
  - ровное выравнивание по сетке
- [ ] Максимум 4 строки
- [ ] Чёткое разделение строк

**Результат:** Данные читаются быстро, без визуального хаоса.

---

## TASK M3.8 — Кнопка «Подробнее» (mobile)

**Действия:**
- [ ] Кнопка: на всю ширину карточки, высота ≥ 44px
- [ ] Привести цвет, шрифт и скругление к макету
- [ ] Добавить лёгкую tap-анимацию

**Результат:** Кнопка удобна для нажатия большим пальцем.

---

## TASK M3.9 — Клик по карточке (mobile)

**Действия:**
- [ ] Тап по карточке открывает страницу новостройки ЖК
- [ ] Исключения: свайп по изображению, кнопка «Подробнее»
- [ ] Убрать конфликт свайпа и клика

**Результат:** Нет случайных переходов при свайпе.

---

## TASK M3.10 — Производительность mobile

**Действия:**
- [ ] Исключить hover-зависимости
- [ ] Использовать: transform, opacity
- [ ] Запретить анимации height / width

**Результат:** Карточка работает плавно даже на слабых устройствах.

---

## TASK M3.11 — Финальная визуальная сверка (mobile)

**Действия:**
- [ ] Сравнить карточку с макетом:
  - шрифты
  - отступы
  - визуальная плотность
  - выравнивание
- [ ] Исправить все расхождения до 100%

**Результат:** Мобильная версия полностью соответствует макету.

---

## Порядок реализации

### Фаза 1 — Структура и типографика
1. **3.1** — Общая структура, высота карточек
2. **3.2** — Заголовок ЖК
3. **3.3** — Цена и подпись
4. **3.4** — Бейджи

### Фаза 2 — Интерактивность
5. **3.5** — Иконка избранного
6. **3.9** — Клик по карточке
7. **3.10** — Кнопка «Все предложения»

### Фаза 3 — Hover и анимации
8. **3.11** — Производительность (transform/opacity)
9. **3.6** — Hover по карточке (переработать без height)
10. **3.7** — Раскрытие квартир (fade + translateY)
11. **3.8** — Перелистывание по mousemove + debounce

### Фаза 4 — Адаптация mobile
12. **3.12** — Мобильная версия (тап, свайп, touch targets)
13. **M3.1** — Структура карточки (mobile)
14. **M3.2** — Изображение ЖК (mobile)
15. **M3.3** — Бейджи (mobile)
16. **M3.4** — Свайп изображений (mobile)
17. **M3.5** — Заголовок ЖК (mobile)
18. **M3.6** — Цена и информация (mobile)
19. **M3.7** — Таблица квартир (mobile)
20. **M3.8** — Кнопка «Подробнее» (mobile)
21. **M3.9** — Клик по карточке (mobile)
22. **M3.10** — Производительность (mobile)
23. **M3.11** — Финальная сверка (mobile)

---

## Важно

- **TASK 3.11** должен быть учтён при реализации 3.6 и 3.7 — избегать `height`/`maxHeight` transitions.
- **ResidentialComplexCard** используется также в `LaunchSalesSection`, `NewBuildingsCatalogPage`, `FavoritesPage` — изменения затронут все места.
- Для mousemove-листания (3.8) — использовать `useMemo`/`useCallback` и debounce (lodash.debounce или собственная реализация).
- **M3.9** — конфликт свайпа и клика: при touchmove/swipe по изображению не должен срабатывать click по карточке. Использовать флаг «был свайп» и отменять переход при его наличии.
